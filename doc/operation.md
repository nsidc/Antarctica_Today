# Operation

> :warning: Warning
>
> This software requires a large amount of memory (min. 8GB), increasingly more as time
> goes on, because the entire climatology is sometimes read in to memory. An error may
> look like:
>
>     numpy.core._exceptions._ArrayMemoryError: Unable to allocate 6.32 GiB for an array
>     with shape (332, 316, 8089) and data type int64
>
> We should move to a tool like SQLite or XArray for managing this data without needing
> so much memory.


## Generating the database

> ‼️ Important
>
> Generating the database is a pre-requesite to all other functionality.

This software manages a database covering the full climatology in the form of a pickle
file.


### Initializing

> 🛠️ _TODO_
>
> - [ ] Simpler command, shouldn't have to know to set PYTHONPATH.

```
PYTHONPATH=. python antarctica_today/melt_array_picklefile.py
```


### Updating

> 🛠️ _TODO_
>
> - [ ] Simpler command, shouldn't have to know to set PYTHONPATH.

```
PYTHONPATH=. python antarctica_today/update_data.py
```


## Generating Antarctica Today maps

The one set of files that is required but not generated by this code are the 37h
threshold binaries provided by Tom Mote.

1. Download all NSIDC-0080 faily granules using `nsidc_download_Tb_data.py`
  * For data before 2016, `NSIDC-0001` and `NSIDC-0007` are used.
2. Generate all the daily melt binary files using `generate_daily_melt_file.py`
  * Binaries provided in `data/daily_melt_bin_files` already calibrated by Tom Mote for
    pre 2016 dates.
3. Run the main script with `--preprocess` flag
4. Run the main script
