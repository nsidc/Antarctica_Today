# Operation

> :warning: Warning
>
> This software requires a large amount of memory (min. 8GB), increasingly more as time
> goes on, because the entire climatology is sometimes read in to memory. An error may
> look like:
>
>     numpy.core._exceptions._ArrayMemoryError: Unable to allocate 6.32 GiB for an array
>     with shape (332, 316, 8089) and data type int64
>
> We should move to a tool like SQLite or XArray for managing this data without needing
> so much memory.

The one set of files that is required but not generated by this code are the 37h
threshold binaries provided by Tom Mote. These are checked in to this repository.

> ‼️ Important
>
> Steps must be performed in order.


## 1. Download NSIDC-0080

Download all NSIDC-0080 granules:

```
PYTHONPATH=. python antarctica_today/nsidc_download_Tb_data.py
```

> :memo: Note
>
> For data before 2016, `NSIDC-0001` and `NSIDC-0007` are used.
> 
> TODO: Does this mean we need to download those too to initialize the db?


## 2. Generate all the daily melt binary files

```
PYTHONPATH=. python antarctica_today/generate_daily_melt_file.py
```

> :memo: Note
> 
> Binaries provided in `data/daily_melt_bin_files` already calibrated by 
> Tom Mote for pre 2016 dates.


## 3. Generate the database

This software manages a database covering the full climatology in the form of a pickle
file.

TODO: is this as simple as "Run the main script with `--preprocess` flag"?


### Initializing

> 🛠️ _TODO_
>
> - [ ] Simpler command, shouldn't have to know to set PYTHONPATH.

Create the melt array picklefile, a file containing a 2d grid for each day:

```
PYTHONPATH=. python antarctica_today/melt_array_picklefile.py
```

Create a gap filled melt picklefile, (TODO: What is it?):

```
PYTHONPATH=. python antarctica_today/generate_gap_filled_melt_picklefile.py
```


### Daily updates

> 🛠️ _TODO_
>
> - [ ] Simpler command, shouldn't have to know to set PYTHONPATH.

> :warning: Warning
>
> All initialization steps above must be completed first.

```
PYTHONPATH=. python antarctica_today/update_data.py
```


## 4. Generate outputs

Run the main script.
